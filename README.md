# FonlineWeb

FonlineWeb — это браузерная MMO по мотивам Fallout 2 с изометрической графикой и многопользовательским взаимодействием. Проект находится на этапе начальной разработки.

## Структура репозитория

- `server/` — серверная часть на TypeScript (Node.js) с поддержкой HTTP API, WebSocket и динамической подгрузкой игровых скриптов.
- `server/game-scripts/` — каталог игровых скриптов, совместимых с системой `include` оригинальной игры.
- `client/` — экспериментальный клиент для визуализации гекс-сетки и отладки перемещений.
- `docks/` — дополнительные материалы и документация.

## Быстрый старт (локально)

```bash
cd server
cp .env.example .env
npm install
npm run dev
```

По умолчанию сервер поднимается на `http://localhost:8080` и открывает WebSocket на том же порту. Для корректной работы требуется доступная база данных PostgreSQL (значение `DATABASE_URL`).

## Гексовая карта и перемещение

Сервер поддерживает прототип игрового мира размером 50×50 гексов в axial-координатах с even-q раскладкой. При подключении по WebSocket игрок автоматически спавнится в центре карты и может перемещаться в шести направлениях. Доступные значения направления: `east`, `northEast`, `northWest`, `west`, `southWest`, `southEast`.

API WebSocket:

- `player:move` — перемещение персонажа. Тело сообщения: `{ "direction": "northEast" }`.
- `player:setName` — переименование персонажа. Тело сообщения: `{ "name": "Имя" }`.

Сервер рассылет широковещательные события `world:*` об изменении состояния мира всем подключённым клиентам.

## Тестовый клиент

В каталоге `client/` находится простая визуализация гексовой сетки с заглушками графики и отрисовкой персонажей. Для запуска достаточно собрать сервер и открыть HTML-файл любым статическим сервером, например:

```bash
npx serve client
```

После открытия страницы клиент попытается подключиться к `ws://<host>:<port>` (порт определяется по адресу страницы, по умолчанию `8080`). Управление персонажем — клавишами `Q`, `W`, `E`, `A`, `S`, `D`. Фон поля чёрный, а каждая клетка визуализируется в стилистике присланного эталона.

## Декодер FR файлов

Для работы с оригинальными анимациями добавлен CLI-скрипт декодирования Fallout FR с применением переданной палитры JASC-PAL. Он извлекает кадры в формате PNG и сохраняет метаданные.

```bash
cd server
npm run decode-fr -- path/to/animation.fr --output ./decoded/animation
```

Опции:

- `--skip-images` — не сохранять PNG-кадры, только метаданные.
- `--skip-metadata` — не сохранять `metadata.json`.
- `-q/--quiet` — отключить подробный вывод.

По умолчанию прозрачность берётся из нулевого индекса палитры, а PNG-файлы группируются по направлениям (`direction_0` ... `direction_5`).

## Docker

Для запуска в контейнере предусмотрен `Dockerfile`. Пример запуска:

```bash
docker build -t fonlineweb-server ./server
```

## План разработки

План и прогресс ведутся в файле [TASKS.md](TASKS.md).

